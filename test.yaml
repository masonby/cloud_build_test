steps:
  - name: 'gcr.io/cloud-builders/wget'
    args: ["https://releases.hashicorp.com/packer/${_PACKER_VERSION}/packer_${_PACKER_VERSION}_linux_amd64.zip"]
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/packer:${_PACKER_VERSION}',
           '-t', 'gcr.io/$PROJECT_ID/packer',
           '--build-arg', 'PACKER_VERSION=${_PACKER_VERSION}',
           '--build-arg', 'PACKER_VERSION_SHA256SUM=${_PACKER_VERSION_SHA256SUM}',
           '.']
  #download wizcli
  - name: gcr.io/cloud-builders/gcloud
    entrypoint: "bash"
    args:
    - "-c"
    - |
       curl -Lo wizcli https://wizcli.app.wiz.io/latest/wizcli-linux-amd64
   #chmod
  - name: gcr.io/cloud-builders/gcloud
    entrypoint: "bash"
    args:
    - "-c"
    - |
       chmod +x wizcli 
   #secret manager
  - name: 'gcr.io/cloud-builders/gcloud'
    entrypoint: 'bash'
    args: ['-c', './wizcli auth --id= $$WIZ_CLIENT_ID --secret=$$WIZ_CLIENT_SECRET']
    secretEnv: ['WIZ_CLIENT_ID', 'WIZ_CLIENT_SECRET']
  availableSecrets:
    secretManager:
    - versionName: projects/$PROJECT_ID/secrets/WIZ_CLIENT_SECRET/versions/1
      env: 'WIZ_CLIENT_SECRET'
    - versionName: projects/$PROJECT_ID/secrets/WIZ_CLIENT_ID/versions/1
      env: 'WIZ_CLIENT_ID'